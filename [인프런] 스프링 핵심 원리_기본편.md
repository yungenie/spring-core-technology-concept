# 🌱 스프링 핵심 원리 기본편
출저 : [`인프런 김영한 - 스프링 핵심 원리 기본편 강의`](https://inf.run/h6Gf)

## 객체 지향 설계와 스프링
### 이야기 - 자바 진영의 추운 겨울과 스프링의 탄생
- EJB > Road Johnson 오픈소스 공개 (EJG 한계 지적) > Juergen Hoeller, Yann Caroff가 Road Johnson 오픈 소스 제안 > 스프링 탄생 (겨울을 넘어 새로운 시작이라는 뜻)

### 스프링이란?
- `좋은 객체 지향` 애플리케이션을 개발할 수 있게 도와주는 프레임워크 입니다.

### 좋은 객체 지향 프로그래밍이란?
- 객체 지향 특징 : 추상화, 상속, 캡슐화, 다형성
- **역할과 구현을 안정적으로 분리**하여 `다형성`을 극대화 시켜 **유연하고 변경에 유리**하게 만든 것이 좋은 객체 지향 프로그래밍 입니다.

### 좋은 객체 지향 설계의 5가지 원칙 (SOLID)
- SOLID - SRP, OCP, LSP, ISP, DIP    
- SRP : `단일 책임 원칙` (Single Responsibility Principle) 
  - **클래스에는 역할과 책임에 따라 분리** 해야 합니다. 그러므로 **한 클래스에는 하나의역역할**을 가져야 합니다.
  - ex) 구현 객체를 생성하고 연결하는 역할 담당. 객체를 기능에 맞게 실행하는 역할 담당 (관심사 분리)

- OCP : `개방-폐쇄 원칙` (Open/Closed Principle)  
  - **역할에 대해 변경은 닫혀** 있으나, **구현 기능에 대해서는 확장성이 열려** 있어야 합니다. (구성과 사용 역할의 분리)
  - **문제점** : 다형성을 사용했지만 구현 객체를 변경하려면 클라이언트 코드를 변경해야 합니다. (※ 클라이언트 : service)
  - **해결** : 객체를 생성하고 연관관계를 맺어주는 별도의 설정자가 필요합니다. (스프링 DI 컨테이너)
  
- LSP : `리스코프 치환 원칙` (Liskov Substitution Principle)
  - **하위 타입의 인스턴스가 상위 인스턴스로 대체**될 수 있어야 합니다.
  - 상위 인스턴스에서 추상화한 기능을 토대로 하위 타입 인스턴스는 목적에 맞는 기능을 구현해야 합니다.
  - ex) 자동차 전진을 하는 메서드인데 후진을 하는 메서드를 구현했을 경우

- ISP : `인터페이스 분리 원칙` (Interface Segregation Principle)
  - **특정 클라이언트에 맞게 인터페이스를 분리** 합니다. 

- DIP : `의존관계 역전 원칙` (Dependency Inversion Principle)
  - 클라이언트가 인터페이스(추상화)에 의존해야 **유연하게 구현체를 변경** 할 수 있습니다. 
  - **문제점** : 인터페이스에 의존하지만, 구현 클래스도 동시에 의존합니다. 
  - **해결** : 애플리케이션 전체 구성 담당을 생성해서 객체 인스턴스의 참조값(주소)를 의존관계 주입
 
- 정리 : 객체 지향의 🌺인 다형성만으로 구현 객체를 변경할 때 클라이언트 코드도 함께 변경됩니다. 다형성만으로는 OCP, DIP 위반 됩니다.
         따라서, 외부에서 구현 객체를 생성해서 의존관계를 주입해야합니다. (제어의 역전)

### 객체 지향 설계와 스프링
- 객체 지향 설계의 5가지 원칙의 위반되는 한계를 **스프링이 OCP, DIP까지 가능하게 지원**해줍니다.
<br>

## 객체 지향 원리 적용
### IoC 제어의 역전 (Inversion of Control)
- 개념 : 직접적인 호출이 아니라 프레임워크가 대신 호출한다는 의미로 `외부에서 관리`하는 것을 뜻합니다.
- ex) 외부에서 제어 흐름에 대한 권한 담당을 맡아 인터페이스의 구현 객체를 생성하고 실행을하고, 구현 객체는 실제 비지니스 로직 실행만 담당을 하게끔 합니다.

### 프레임워크 vs 라이브러리
- 작성한 코드를 제어하고, 대신 실행하면 그것은 프레임워크 입니다.
- 내가 작성한 코드라 직접 제어의 흐름에 담당한다면 라이브러리 입니다.

### DI 의존관계 주입 (Dependency Injection)
- `클라이언트와 서버의 실제 의존관계가 연결`되는 것을 의존관계 주입이라고 합니다.
- **객체 인스턴스를 생성** 후 해당 **참조값을 전달**해서 연결시켜주는 것 입니다.
- 의존관계는 정적인 클래스 의존관계와, 실행 시점에 결정되는 동적인 객체(인스턴스) 의존 관계로 분리해서 생각할 수 있습니다.

#### 정적인 클래스 의존관계
- 코드로만 보고 의존관계를 쉽게 판단할 수 있습니다. 
- 애플리케이션을 실행하지 않아도 분석 가능합니다.

#### 동적인 객체 인스턴스 의존관계
- **애플리케이션 실행 시점**에 생성된 객체 인스턴스의 참조값이 연결된 의존관계를 뜻합니다.

#### 의존관계 정리
- 의존관계 주입을 사용하면 정적인 클래스 의존관계를 변경하지 않고, 동적인 객체 인스턴스 의존관계를 유연하게 변경할 수 있습니다.

### DI 컨테이너
- `객체를 생성하고 관리하면서 의존관계를 연결`해주는 것을 IoC 컨테이너 or DI 컨테이너라고 합니다.
- 또는 어샘블러, 오브젝트 팩토리 등으로 불리기도 합니다.

### 3줄 요약 정리
> 1. 추상화(인터페이스)과 구현을 나눠서 각 **역할**을 나누고 구현 객체에 의존하지 않고 **추상에 의존**하게 하여 구성합니다. (SOLID)
> 2. 어플리케이션 실행시점에 추상화를 등록하고 비지니스 로직인 구현 객체의 인스턴스의 참조값으로 **생성자 의존관계 주입** 합니다. (IoC, DI)
> 3. **프레임워크(스프링)를 통해** 추상화를 등록하고 구현 객체 의존관계 주입을 **외부에서 관리**하게 하도록 합니다. (DI 컨테이너)
<br>

## 스프링 컨테이너와 스프링 빈
### 스프링 컨테이너 생성
- `ApplicationContext`를 스프링 컨테이너라 합니다.
- 구성정보를 통해서 스프링 컨테이너의 `스프링 저장소(빈이름, 빈객체)`에 생성합니다.
  - 구성정보는 AppConfig, 빈이름은 @Bean 어노테이션이 붙은 메서드명, 빈객체는 구현체 인스턴스 주소 입니다.
- 구성정보(설정정보)를 참고해서 **스프링 빈을 등록하는 동시에 의존관계를 주입**합니다.

### 스프링 빈 조회
- 거의 사용하진 않지만, 순수한 자바 애플리케이션에서 스프링 컨테이너를 생성해서 써야하는 경우가 있습니다.
- 그때 자동의존관계에서 문제 없이 해결할 수 있도록 ApplicationContext에서 bean을 조회해서 확인합니다.

### BeanFactory와 ApplicationContext
- BeanFactory(i/f) > ApplicationContext(i/f) > AnnotationConfig/ApplicationContext
- BeanFactory, ApplicationContext 모두 스프링 컨테이너라고 합니다.

### 3줄 요약 정리
> 1. 스프링 컨테이너의 스프링 저장소(빈이름, 빈객체)에 스프링 빈을 등록하는 동시에 의존관계를 주입합니다.
> 2. 스프링 컨테이너의 스프링을 등록하는 방법은 크게 2가지가 있습니다.
>    - 직접 스프링 빈을 스프링 컨테이너에 등록하는 방법 (xml) (레거시 방법)
>    - 외부에서 메서드 호출해서 제공하는 방식으로 factoryBean을 통해 등록하는 방법 (AppConfig) (factoryBean method 방법)
> 3. 스프링이 **다양한 형태**의 설정 정보를 BeanDefinition으로 추상화해서 사용합니다.
<br>

## 싱글톤 컨테이너
### @Configuration과 바이트코드 조작의 마법
- 스프링 컨테이너는 **기본적**으로 `싱글톤`으로 만들어서 관리해줍니다.
- 스프링 설정 정보에 @Configuration을 붙이면 `바이트코드를 조작하는 CGLID` 기술을 적용해서 **싱글톤을 보장**해줍니다.
- @Bean만 사용해도 스프링 빈으로 등록되지만, 싱글톤은 보장하지 않는다. 그러므로 `항상 @Configuration`을 사용해야 합니다.

#### 싱글톤을 보장해주는 방식?
- @Bean이 붙은 메서드마다 이미 스프링 빈이 존재하면 존재하는 빈을 반환하고, 스프링 빈이 없으면 생성해서 스프링 빈을 등록하고 반환하는 코드가 동적으로 만들어 집니다. 
- 덕분에 싱글톤이 보장됩니다.

### 3줄 요약 정리
> 1. 스프링 컨테이너가 싱글톤을 보장해줍니다.
> 2. @Configuration 어노테이션을 붙여 스프링이 CGLID 바이트코드 조작 라이브러리 사용해서 임의의 클래스를 생성 해서 스프링 빈으로 등록합니다.
> 3. @Configuration 어노테이션을 빼고 @Bean 어노테이션만 사용해도 스프링 빈으로 등록되지만, 싱글톤은 보장하지 않습니다.




